var tjucmRelatedFieldUpdatedOptions="",tjUcmTinyMCEFieldIds=new Array,tjUcmClickedOnNext=0,tjUcmClickedOnPrev=0,tjUcmCurrentAutoSaveState=0,tjUcmFormFinalSaveClose=0,tjUcmFormFinalSave=0,tjUcmJCEFieldIds=new Array,tjUcmFormSavedByBitRateConfig=0,tjUcmSaveFormInDraftWithNoMsg=void 0,tjUcmFormSubmitCallingButtonId="";jQuery(window).on("load",(function(){var e=Number(jQuery("#itemState").val()),t=Number(jQuery("#isROPForm").val()),r=jQuery("#item-form #tjucm-bitrate").val(),a=jQuery("#item-form #tjucm-bitrate_seconds").val();if(1===e||1===t){var n=jQuery("#item-form #tjucm-autosave").val();if(r=jQuery("#item-form #tjucm-bitrate").val(),a=jQuery("#item-form #tjucm-bitrate_seconds").val(),1==n){if(tjUcmCurrentAutoSaveState=1,jQuery("#item-form").on("change select",":input",(function(){tjUcmCurrentAutoSaveState&&tjUcmItemForm.onUcmFormChange(this)})),jQuery("#item-form .field-calendar input:text").blur((function(){})),jQuery("#item-form .js-editor-tinymce").length>0){var i=Joomla.getOptions("plg_editor_tinymce");null!=i&&jQuery.each(i.tinyMCE,(function(e,t){if(jQuery("#item-form #jform_"+e).length){var r=jQuery("#jform_"+e+"_ifr").contents().find("body").html();tjUcmTinyMCEFieldIds[e]=r}else if(0==jQuery("#item-form #jform_"+e).length&&"default"!=e){var a=jQuery("textarea[id$='__"+e+"']");a.length&&jQuery.each(a,(function(e,t){var r=jQuery(t).attr("id"),a=jQuery("#"+r+"_ifr").contents().find("body").html(),n=r.replace("jform_","");tjUcmTinyMCEFieldIds[n]=a}))}}))}jQuery("#item-form .wf-editor-container").length>0&&setTimeout((function(){jQuery("#item-form .mceIframeContainer iframe").each((function(){var e=jQuery(this).attr("id"),t=e.replace("jform_","").replace("_ifr",""),r=jQuery("#"+e).contents().find("body").html();tjUcmJCEFieldIds[t]=r}))}),2e3),1==n&&1==r&&void 0!==a&&jQuery("#item-form #tjUcmSectionDraftSave").length>=1&&setInterval((function(){for(var e in(jQuery("#item-form").hasClass("dirty")||0===tjUcmFormSavedByBitRateConfig)&&(tjUcmFormSavedByBitRateConfig=1,jQuery("#tjUcmSectionDraftSave").click()),tjUcmJCEFieldIds)if(tjUcmJCEFieldIds.hasOwnProperty(e)){var t=jQuery("#jform_"+e+"_ifr").contents().find("body").html();if(tjUcmJCEFieldIds[e]!=t){var r=jQuery("#jform_"+e);r.length&&(r.val(t),tjUcmJCEFieldIds[e]=t,tjUcmItemForm.onUcmFormChange(r))}}if(jQuery("#item-form .js-editor-tinymce").length>0)for(var e in tjUcmTinyMCEFieldIds)if(tjUcmTinyMCEFieldIds.hasOwnProperty(e)){var a=jQuery("#jform_"+e+"_ifr").contents().find("body").html();if(tjUcmTinyMCEFieldIds[e]!=a){var n=jQuery("#jform_"+e);n.length&&(n.val(a),tjUcmTinyMCEFieldIds[e]=a,tjUcmItemForm.onUcmFormChange(n))}}}),1e3*a)}}else jQuery("#tjucm-auto-save-disabled-msg").show();jQuery("#tjucm_myTabTabs a").on("click",(function(){jQuery(this).parent().next("li").length?jQuery("#next_button").attr("disabled",!1):jQuery("#next_button").attr("disabled",!0),jQuery(this).parent().prev("li").length?jQuery("#previous_button").attr("disabled",!1):jQuery("#previous_button").attr("disabled",!0)})),jQuery(document).on("subform-row-add",(function(e,t){var r,a=jQuery(e.detail.row).attr("data-group").replace(jQuery(e.detail.row).attr("data-base-name"),"");if(jQuery(e.detail.row).find(".js-editor-tinymce textarea")&&(r=jQuery(e.detail.row).find(".js-editor-tinymce textarea").attr("id"))){var n=jQuery("#"+r+"_ifr").contents().find("body").html();r=r.replace("jform_",""),tjUcmTinyMCEFieldIds[r]=n}jQuery(e.detail.row).find(".wf-editor-container textarea")&&(r=jQuery(e.detail.row).find(".wf-editor-container textarea").attr("id"))&&(n=jQuery("#"+r+"_ifr").contents().find("body").html(),r=r.replace("jform_",""),tjUcmTinyMCEFieldIds[r]=n),jQuery.each(tjucmRelatedFieldUpdatedOptions,(function(t,r){if(r.templateId){var n=r.templateId.replace("XXX_XXX",a);jQuery(e.detail.row).find("#"+n).html(""),jQuery.each(r.options,(function(t,r){jQuery(e.detail.row).find("#"+n).append('<option value="'+r.value+'">'+r.text+"</option>")})),jQuery(e.detail.row).find("#"+n).trigger("chosen:updated")}}))})),jQuery("#next_button, #previous_button").on("click",(function(){if("next_button"==jQuery(this).attr("id")?tjUcmClickedOnNext=1:tjUcmClickedOnPrev=1,jQuery("#item-form").hasClass("dirty"))if(tjUcmCurrentAutoSaveState){var e=jQuery(jQuery("#tjucm_myTabTabs > .active a").attr("href")).find("input, textarea, select, fieldset");tjUcmItemForm.validateSection(e)?tjUcmItemForm.saveSectionData(jQuery("#tjucm_myTabTabs > .active a").attr("href")):(tjUcmClickedOnNext=0,tjUcmClickedOnPrev=0),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow")}else e=jQuery(jQuery("#tjucm_myTabTabs > .active a").attr("href")).find("input, textarea, select, fieldset"),tjUcmItemForm.validateSection(e)?(jQuery("#system-message-container").html(""),tjUcmClickedOnNext&&(tjUcmClickedOnNext=0,jQuery("#tjucm_myTabTabs > .active").next("li").find("a").trigger("click"),tjUcmItemForm.setVisibilityOfNavigationButtons()),tjUcmClickedOnPrev&&(tjUcmClickedOnPrev=0,jQuery("#tjucm_myTabTabs > .active").prev("li").find("a").trigger("click"),tjUcmItemForm.setVisibilityOfNavigationButtons())):(tjUcmClickedOnNext=0,tjUcmClickedOnPrev=0),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow");else e=jQuery(jQuery("#tjucm_myTabTabs > .active a").attr("href")).find("input, textarea, select, fieldset"),tjUcmItemForm.validateSection(e)?(jQuery("#system-message-container").html(""),tjUcmClickedOnNext&&(tjUcmClickedOnNext=0,jQuery("#tjucm_myTabTabs > .active").next("li").find("a").trigger("click"),tjUcmItemForm.setVisibilityOfNavigationButtons()),tjUcmClickedOnPrev&&(tjUcmClickedOnPrev=0,jQuery("#tjucm_myTabTabs > .active").prev("li").find("a").trigger("click"),tjUcmItemForm.setVisibilityOfNavigationButtons())):(tjUcmClickedOnNext=0,tjUcmClickedOnPrev=0),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow")}))}));var tjUcmItemForm={getUcmParentRecordId:function(e,t){var r=jQuery("#item-form").find("input[name='jform[client]']").val();new Promise((function(t,a){var n=jQuery("#item-form").find("input[name='jform[id]']").val();if(""==n){var i=new FormData;""!=r&&i.append("client",r),i.append(Joomla.getOptions("csrf.token"),1),i.append("draft",e),com_tjucm.Services.Item.create(i,(function(e,r){if(r=JSON.parse(r),null==e)if(null!==r.data&&jQuery.isNumeric(r.data.id)){jQuery("#item-form").find("input[name='jform[id]']").val(r.data.id);var n=window.location.href.split("#")[0],i=-1===n.indexOf("?")?"?":"&",o="id="+r.data.id;n.indexOf(o)>=0||(n+=i+o),history.pushState(null,null,n),t(r.data.id)}else a(r)}))}else jQuery.isNumeric(n)&&0!=n&&t(n)})).then((function(e){t(e)})).catch((function(e){return console.log(e),!1}))},onUcmFormChange:function(e){jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0),tjUcmItemForm.getUcmParentRecordId(1,(function(t){var r=jQuery("#item-form").find("input[name='jform[client]']").val();tjUcmItemForm.initUcmFormFieldDataSave(e,r,t)}))},initUcmFormFieldDataSave:function(e,t,r){jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0);var a="",n=new FormData;if(n.append(Joomla.getOptions("csrf.token"),1),void 0!==jQuery(e).parent().parent().parent().attr("data-base-name")||void 0!==jQuery(e).parent().parent().parent().parent().attr("data-base-name")||void 0!==jQuery(e).parent().parent().parent().parent().parent().attr("data-base-name")||void 0!==jQuery(e).parent().parent().parent().parent().parent().parent().attr("data-base-name")){var i=jQuery(e).parent().parent().parent().attr("data-base-name");null==i&&(i=jQuery(e).parent().parent().parent().parent().attr("data-base-name"));var o=jQuery(e).attr("id"),m="com_tjucm."+(a=o.replace(o.split("_").pop(),"contentid")).split("__").pop().replace("_contentid","").replace("com_tjucm_",""),u=jQuery("#"+a).val();if(""==u)n.append("parent_id",r),n.append("client",m),"com_tjucm.ropdataflow"==m&&n.append("PreElementValue",jQuery("#"+o).attr("data-prev-element-id")),n.append("draft",1),com_tjucm.Services.Item.create(n,(function(o,u){if(u=JSON.parse(u),null==o)return null!==u.data&&jQuery.isNumeric(u.data.id)&&jQuery("#"+a).val(u.data.id),n.append("jform["+i+"]",m),n.append("client",t),n.append("recordid",r),com_tjucm.Services.Item.saveFieldData(n,(function(t,r){var a=jQuery(e).attr("name"),n="[]"==a.slice(-2)?"[]":"",i="jform["+jQuery(e).attr("id").split("__").pop()+"]"+n;"radio"==jQuery(e).attr("type")&&(i="jform["+jQuery(e).attr("name").split("][").pop()),jQuery(e).attr("name",i),tjUcmItemForm.saveUcmFormFieldData(m,u.data.id,e),jQuery(e).attr("name",a)})),!0}));else{if(jQuery.isNumeric(u)&&0!=u){var c=jQuery(e).attr("name"),l="[]"==c.slice(-2)?"[]":"",s="jform["+jQuery(e).attr("id").split("__").pop()+"]"+l;return"radio"==jQuery(e).attr("type")&&(s="jform["+jQuery(e).attr("name").split("][").pop()),jQuery(e).attr("name",s),tjUcmItemForm.saveUcmFormFieldData(m,u,e),jQuery(e).attr("name",c),!0}null==u&&(tjUcmSaveFormInDraftWithNoMsg=1,tjUcmFormSubmitCallingButtonId="tjUcmSectionDraftSave",jQuery("#tjUcmSectionDraftSave").click())}return!1}return tjUcmItemForm.saveUcmFormFieldData(t,r,e),!0},saveUcmFormFieldData:function(e,t,r){jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0);var a=new FormData;return a.append(Joomla.getOptions("csrf.token"),1),a.append("client",e),a.append("recordid",t),"checkbox"==jQuery(r).attr("type")?1==jQuery(r).prop("checked")?a.append(jQuery(r).attr("name"),1):a.append(jQuery(r).attr("name"),0):jQuery(r).hasClass("tjfieldTjList")?(""!=jQuery(r).val()&&null!=jQuery(r).val()?a.append(jQuery(r).attr("name"),jQuery(r).val()):a.append(jQuery(r).attr("name"),""),""!=jQuery("input#"+jQuery(r).attr("id")).val()&&null!=jQuery("input#"+jQuery(r).attr("id")).val()&&a.append(jQuery(r).attr("name"),jQuery("input#"+jQuery(r).attr("id")).val())):"tagsinput"==jQuery("input#"+jQuery(r).attr("id")).data("role")?(""!=jQuery("#"+jQuery(r).attr("id")).val()&&null!=jQuery("#"+jQuery(r).attr("id")).val()&&a.append(jQuery(r).attr("name"),jQuery("#"+jQuery(r).attr("id")).val()),""!=jQuery(r).val()&&null!=jQuery(r).val()&&a.append(jQuery(r).attr("name"),jQuery(r).val())):"file"==jQuery(r).attr("type")?a.append(jQuery(r).attr("name"),jQuery(r)[0].files[0]):null==jQuery(r).val()?a.append(jQuery(r).attr("name"),""):a.append(jQuery(r).attr("name"),jQuery(r).val()),""!=jQuery(r).attr("name")&&null!=jQuery(r).attr("name")&&com_tjucm.Services.Item.saveFieldData(a,tjUcmItemForm.afterDataSave),!0},afterDataSave:function(error,response){if(jQuery("#item-form #tjucm_loader").hide(),response=JSON.parse(response),jQuery("#item-form").removeClass("dirty"),null==response)return!1;jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!1),null!=response.data&&response.data.childContentIds&&jQuery.each(response.data.childContentIds,(function(e,t){jQuery("#"+e).val(t)})),response.data&&(tjUcmFormFinalSaveClose||tjUcmFormFinalSave)&&(jQuery("#tjucm-auto-save-disabled-msg").show(),jQuery("#itemState").val(0),jQuery("#tjUcmSectionDraftSave").remove(),tjUcmCurrentAutoSaveState=0,tjUcmFormFinalSave=0);var isROPForm=Number(jQuery("#isROPForm").val());if(1===isROPForm&&(currentUcmID=jQuery("#recordId").val(),jQuery.ajax({url:Joomla.getOptions("system.paths").root+"/index.php?option=com_dpe&task=tjucm.getDynamicTree&format=json",type:"POST",data:{ucmId:currentUcmID},dataType:"json",complete:function(){}}).done((function(response){document.getElementById("DragDropHTMLCover").innerHTML=response.data.html,jQuery("#DragDropHTMLCover").find("script").each((function(){eval(jQuery(this).text())})),document.querySelector("#SuccessMsg").removeClass("hide"),setTimeout((function(){document.querySelector("#SuccessMsg").addClass("hide")}),1e3)})).fail((function(e){})).always((function(){}))),tjUcmClickedOnNext&&(tjUcmClickedOnNext=0,jQuery("#tjucm_myTabTabs > .active").next("li").find("a").trigger("click")),tjUcmClickedOnPrev&&(tjUcmClickedOnPrev=0,jQuery("#tjucm_myTabTabs > .active").prev("li").find("a").trigger("click")),tjUcmItemForm.setVisibilityOfNavigationButtons(),response.data){var tjUcmParentClient=jQuery("#item-form").find("input[name='jform[client]']").val(),tjucmParentRecordId=jQuery("#item-form").find("input[name='jform[id]']").val();tjUcmItemForm.updateRelatedFieldsOptions(tjUcmParentClient,tjucmParentRecordId)}tjUcmItemForm.renderResponseMessages(response),response.data.success&&""!=jQuery.trim(response.data.redirectUrl)&&null!=response.data.redirectUrl&&"json"!=jQuery("#documentType").val()&&tjUcmFormFinalSaveClose&&setTimeout((function(){window.location.href=response.data.redirectUrl}),2e3)},renderResponseMessages:function(e){null!=e&&(null!==e.message&&(e.data?Joomla.renderMessages({success:[e.message]}):Joomla.renderMessages({error:[e.message]}),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top-300},"slow")),null!==e.messages&&null!==e.messages.error&&(jQuery.each(e.messages.error,(function(e,t){Joomla.renderMessages({error:[t]})})),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top-300},"slow")))},updateRelatedFieldsOptions:function(e,t){var r=new FormData;r.append("client",e),r.append("content_id",t),com_tjucm.Services.Item.getUpdatedRelatedFieldsOptions(r,(function(e,t){if(t=JSON.parse(t),""==(tjucmRelatedFieldUpdatedOptions=t.data))return!1;jQuery.each(t.data,(function(e,t){jQuery("#"+t.elementId).html(""),jQuery.each(t.options,(function(e,r){var a="";"1"==r.selected&&(a=' selected="selected" '),jQuery("#"+t.elementId).append('<option value="'+r.value+'" '+a+">"+r.text+"</option>")})),jQuery("#"+t.elementId).trigger("chosen:updated")}))}))},saveUcmFormData:function(){window.onbeforeunload=null,editorcontent(),jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0),void 0===event?(tjUcmFormSubmitCallingButtonId="tjUcmSectionDraftSave",tjUcmSaveFormInDraftWithNoMsg=1):tjUcmFormSubmitCallingButtonId="tjUcmSectionDraftSave"==event.target.id||"tjUcmSectionFinalSave"==event.target.id||"tjUcmSectionFinalSaveClose"==event.target.id?event.target.id:"tjUcmSectionDraftSave";var e=1,t=jQuery("#custForm").val();if(Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_ALERT"),"1"==t&&Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_DPE_CONFIRMATION"),"tjUcmSectionFinalSave"==tjUcmFormSubmitCallingButtonId||"tjUcmSectionFinalSaveClose"==tjUcmFormSubmitCallingButtonId){if(!document.formvalidator.isValid(document.getElementById("item-form")))return tjUcmItemForm.setVisibilityOfNavigationButtons(),jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!1),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow"),!1;if(!confirm(Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_ALERT")))return jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!1),!1;jQuery("#system-message-container").html(""),jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0),e=0}if(jQuery("#item-form .toggle-editor a").each((function(e){this.click()})),jQuery("#item-form .wf-editor-toggle").each((function(e){this.click()})),jQuery("#item-form #tjucm_loader").show(),1==!tjUcmSaveFormInDraftWithNoMsg&&(jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow"),jQuery("#tmplPopUp").val())){var r=1;setInterval((function(){r-=1,jQuery("#countermsg").removeClass("d-none"),0==r&&window.parent.parent.SqueezeBox.close()}),2e3)}tjUcmItemForm.getUcmParentRecordId(e,(function(){var e=document.getElementById("item-form"),t=new FormData(e);t.delete("task"),t.delete("option"),t.delete("view"),t.delete("layout");var r=jQuery("#item-form").find("input[name='jform[client]']").val(),a=jQuery("#item-form").find("input[name='jform[id]']").val();t.append(Joomla.getOptions("csrf.token"),1),t.append("client",r),t.append("recordid",a),"tjUcmSectionDraftSave"==tjUcmFormSubmitCallingButtonId&&t.append("draft",1),"tjUcmSectionFinalSaveClose"==tjUcmFormSubmitCallingButtonId&&(tjUcmFormFinalSaveClose=1),"tjUcmSectionFinalSave"==tjUcmFormSubmitCallingButtonId&&(tjUcmFormFinalSave=1),tjUcmFormSubmitCallingButtonId="",jQuery('#item-form input[type="checkbox"]').each((function(){1==jQuery(this).prop("checked")?t.append(jQuery(this).attr("name"),1):t.append(jQuery(this).attr("name"),0)})),jQuery("#item-form select").each((function(){null==jQuery(this).val()&&t.append(jQuery(this).attr("name"),"")})),void 0!==tjUcmSaveFormInDraftWithNoMsg&&(tjUcmSaveFormInDraftWithNoMsg=void 0,t.append("showDraftMessage",0)),com_tjucm.Services.Item.saveFormData(t,tjUcmItemForm.afterDataSave)})),jQuery("#item-form .toggle-editor a").each((function(e){this.click()})),jQuery("#item-form .wf-editor-toggle").each((function(e){this.click()}))},saveSectionData:function(e){jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0);var t=new FormData,r=jQuery(e).find("input, textarea, select, fieldset");if(!tjUcmItemForm.validateSection(r))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow"),!1;jQuery("#system-message-container").html(""),jQuery("#item-form .toggle-editor a").each((function(e){this.click()})),r.length&&r.each((function(){"file"==jQuery(this).attr("type")?null!=jQuery(this)[0].files[0]&&t.append(jQuery(this).attr("name"),jQuery(this)[0].files[0]):"checkbox"==jQuery(this).attr("type")?1==jQuery(this).prop("checked")?jQuery(this).val(1):jQuery(this).val(0):null!=jQuery(this).val()&&t.append(jQuery(this).attr("name"),jQuery(this).val())})),jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!0),tjUcmItemForm.getUcmParentRecordId(1,(function(){t.delete("task"),t.delete("option"),t.delete("view"),t.delete("layout");var r=jQuery("#item-form").find("input[name='jform[client]']").val(),a=jQuery("#item-form").find("input[name='jform[id]']").val();t.append(Joomla.getOptions("csrf.token"),1),t.append("client",r),t.append("recordid",a),t.append("tjUcmFormSection",jQuery("a[href='"+e+"']").html()),com_tjucm.Services.Item.saveFormData(t,tjUcmItemForm.afterDataSave)}))},validateSection:function(e){var t,r,a,n,i,o=!0,m=[];for(n=0,i=e.length;n<i;n++)jQuery(e[n]).hasClass("novalidate")||!1===document.formvalidator.validate(e[n])&&(o=!1,m.push(e[n]));if(jQuery.each(document.formvalidator.custom,(function(e,t){!0!==t.exec()&&(o=!1)})),!o&&m.length>0){for(t=Joomla.JText._("JLIB_FORM_FIELD_INVALID"),r={error:[]},n=m.length-1;n>=0;n--)(a=jQuery(m[n]).data("label"))&&r.error.push(t+a.text().replace("*",""));Joomla.renderMessages(r)}return o},setVisibilityOfNavigationButtons:function(){var e=jQuery("#tjucm_myTabTabs").find("li.active");jQuery(e).length&&(jQuery(e).next("li").length?jQuery("#next_button").attr("disabled",!1):jQuery("#next_button").attr("disabled",!0),jQuery(e).prev("li").length?jQuery("#previous_button").attr("disabled",!1):jQuery("#previous_button").attr("disabled",!0))},getRelatedFieldOptions:function(e,t,r){var a=new FormData,n={fieldId:t};n.SelectedValues=jQuery("#"+e).val(),""!=jQuery.trim(t)&&"undefined"!=t&&(jQuery("#"+e+", .chosen-results").empty(),a.append("fieldId",t),a.append("clusterId",r),com_tjucm.Services.Item.getRelatedFieldOptions(a,(function(t,r){if(r=JSON.parse(r),""==(tjucmRelatedFieldUpdatedOptions=r.data))return!1;for(var a="",i="",o=r.data,m=0;m<o.length;++m)a="",null!==n.SelectedValues&&void 0!==n.SelectedValues&&n.SelectedValues.length>0&&n.SelectedValues.includes(o[m].value)&&(a=' selected="selected" '),i="<option value='"+o[m].value+"' "+a+" > "+o[m].text+"</option>",jQuery("#"+e).append(i);jQuery("#"+e).trigger("chosen:updated")})))}};function steppedFormSave(e,t,r){window.onbeforeunload=null,jQuery("#item-form .toggle-editor a").each((function(e){this.click()}));var a=jQuery("#"+e),n=!1;if(jQuery("#form_status").val(t),"save"==t){var i=jQuery("#custForm").val();if(Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_ALERT"),"1"==i&&Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_DPE_CONFIRMATION"),!document.formvalidator.isValid("#item-form"))return jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!1),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow"),!1;if(!confirm(Joomla.JText._("COM_TJUCM_ITEMFORM_SUBMIT_ALERT")))return jQuery(".form-actions button[type='button'], .form-actions input[type='button']").attr("disabled",!1),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow"),!1;jQuery("#item-form").removeClass("dirty")}return a&&jQuery(a).ajaxSubmit({datatype:"JSON",async:!1,success:function(e){var a=JSON.parse(e);if(null!==a.messages&&null!==a.messages.error&&(jQuery.each(a.messages.error,(function(e,t){Joomla.renderMessages({error:[t]})})),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow")),null!==a.message&&""!=a.message&&(Joomla.renderMessages({info:[a.message]}),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top},"slow")),null!==a.data){jQuery("#recordId").val(a.data.id),"save"==t?(jQuery("#tjUcmSectionFinalSaveClose").attr("disabled","disabled"),jQuery("#tjUcmSectionFinalSave").attr("disabled","disabled"),Joomla.renderMessages({success:[Joomla.JText._("COM_TJUCM_MSG_ON_SAVED_FORM")]}),jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").offset().top-40},"slow")):(n=!0,"1"===r&&(jQuery("#draft_msg").show(),setTimeout((function(){jQuery("#draft_msg").hide()}),5e3)));var i=window.location.href.split("#")[0],o=-1===i.indexOf("?")?"?":"&",m="id="+a.data.id;jQuery.each(a.data.childContentIds,(function(e,t){jQuery("input[name='"+t.elementName+"']").val(t.content_id)})),tjucmRelatedFieldUpdatedOptions=a.data.relatedFieldOptions,jQuery.each(a.data.relatedFieldOptions,(function(e,t){jQuery("#"+t.elementId).html(""),jQuery.each(t.options,(function(e,r){var a="";"1"==r.selected&&(a=' selected="selected" '),jQuery("#"+t.elementId).append('<option value="'+r.value+'" '+a+">"+r.text+"</option>")})),jQuery("#"+t.elementId).trigger("chosen:updated")})),i.indexOf(m)>=0||(i+=o+m),history.pushState(null,null,i)}jQuery("#tjUcmSectionDraftSave").attr("disabled",!1),jQuery("#tjUcmSectionFinalSaveClose").attr("disabled",!1),jQuery("#tjUcmSectionFinalSave").attr("disabled",!1),jQuery("#item-form .toggle-editor a").each((function(e){this.click()}))}}),n}function itemformactions(e,t){var r=jQuery("ul#tjucm_myTabTabs").find("li.active a");null==jQuery(r).next("li")?jQuery("#previous_button").attr("disabled",!0):jQuery("#previous_button").attr("disabled",!1),null==jQuery(r).prev("li")?jQuery("#next_button").attr("disabled",!0):jQuery("#next_button").attr("disabled",!1),next?jQuery("#tjucm_myTabTabs > .active").next("li").find("a").trigger("click"):jQuery("#tjucm_myTabTabs > .active").next("li").prev("a").trigger("click");var a=jQuery("ul#"+getTabId).find("li.active").next("li").children("a").attr("href"),n=jQuery("ul#"+getTabId).find("li.active").prev("li").children("a").attr("href");null==a?jQuery("#next_button").attr("disabled",!0):jQuery("#next_button").attr("disabled",!1),null==n?jQuery("#previous_button").attr("disabled",!0):jQuery("#previous_button").attr("disabled",!1),steppedFormSave("item-form","draft",1),"next"==t&&jQuery("#"+getTabId+" > .active").next("li").find("a").trigger("click"),"prev"==t&&jQuery("#"+getTabId+" > .active").prev("li").find("a").trigger("click")}function editorcontent(){jQuery("iframe").each((function(){try{var e=this.contentDocument||this.contentWindow.document;e&&jQuery(e).find(".mce-content-body").each((function(){var e=jQuery(this).attr("data-id"),t=jQuery(this).html().trim();jQuery("#"+e).text(t)}))}catch(e){console.warn("Cross-origin access blocked. Using postMessage."),this.contentWindow.postMessage({type:"getEditorContent"},"*")}}))}window.addEventListener("message",(function(e){(e.origin.includes("https://dataprotection.education")||e.origin.includes("https://qa.dataprotection.education"))&&"editorContent"===e.data.type&&jQuery("#"+e.data.dataId).text(e.data.content)}),!1);